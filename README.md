# Ecclesiastical Latin: 40 Days to Sacred Language

All site design, development, and course content by [masaharumori7](https://github.com/masaharumori7/church-latin-40).

This fork adds authentication via Auth0 and data storage using PocketBase.

## Environment Configuration

### Required Environment Variables

This application requires the following environment variables to run:

1. **VITE_AUTH0_DOMAIN** - Your Auth0 application domain
   - Format: `your-domain.auth0.com` or `your-domain.region.auth0.com`
   - Get from: [Auth0 Dashboard](https://manage.auth0.com/dashboard)

2. **VITE_AUTH0_CLIENT_ID** - Your Auth0 application client ID
   - Get from: [Auth0 Dashboard](https://manage.auth0.com/dashboard)

3. **VITE_POCKETBASE_URL** - URL where your PocketBase instance is running
   - Local development: `http://localhost:8080`
   - Production: `https://your-pb-instance.com`

### Optional Environment Variables

- **VITE_GITHUB_ISSUES_URL** - URL to your GitHub issues page (used in error boundary)

### Setup Instructions

1. Copy `.env.example` to `.env.local`:

   ```bash
   cp .env.example .env.local
   ```

2. Update `.env.local` with your actual configuration values:

   ```bash
   VITE_AUTH0_DOMAIN=your-domain.auth0.com
   VITE_AUTH0_CLIENT_ID=your-client-id
   VITE_POCKETBASE_URL=http://localhost:8090
   ```

3. The application will automatically validate your environment configuration on startup and provide detailed error messages if any required variables are missing or incorrectly formatted.

### Environment Validation

The application includes built-in environment validation that checks:

- ✓ All required variables are present
- ✓ Auth0 domain format is valid
- ✓ Auth0 client ID has reasonable length
- ✓ PocketBase URL is a valid URL with proper protocol
- ✓ PocketBase collection name follows naming conventions

If validation fails, the application will display detailed error messages indicating which variables need to be fixed and what the correct format should be.

## PocketBase Collections

Ensure you have the following collections set up in your PocketBase instance:

### 1. **users** (Built-in Auth Collection)

Auto-generated by PocketBase. Used for storing user authentication credentials created from Auth0 emails.

**Fields:**

- `email` (Email) - User's email address
- `password` (Password) - Hashed password
- `passwordConfirm` (Password) - Password confirmation

### 2. **church_latin_user_progress**

Stores user progress data for the course.

**Fields:**

- `userId` (Text) - Reference to the PocketBase user ID
- `completedLessons` (Number Array) - Array of completed lesson IDs
- `quizScores` (JSON) - Object mapping lesson IDs to quiz scores (e.g., `{"1": 85, "2": 92}`)
- `currentLesson` (Number) - Current lesson number being studied (1-40)
- `theme` (Select) - User's theme preference ("light" or "dark")
- `lastAccessedAt` (DateTime) - ISO timestamp of last access
- `lastLessonAccessedId` (Number) - Last lesson viewed by user
- `totalProgress` (Number) - Cached completion percentage (0-100)

**Indexes:**

- Create an index on `userId` for faster lookups

### 3. **church_latin_modules**

Stores module (course section) information.

**Fields:**

- `moduleNumber` (Number) - Module identifier (1-5)
- `name` (Text) - Module title/name
- `description` (Text) - Module description
- `lessonCount` (Number) - Number of lessons in module
- `displayOrder` (Number) - Order to display modules

**Indexes:**

- Create an index on `moduleNumber` for lookups

### 4. **church_latin_lessons**

Stores lesson metadata for each lesson.

**Fields:**

- `lessonNumber` (Number) - Lesson identifier (1-40)
- `moduleId` (Text) - Reference to module's PocketBase ID (from `church_latin_modules`)
- `name` (Text) - Lesson title
- `displayOrder` (Number) - Order within the module

**Indexes:**

- Create an index on `lessonNumber` for quick lookups
- Create an index on `moduleId` for filtering by module

### 5. **church_latin_lesson_content**

Stores detailed content for each lesson (lazy-loaded).

**Fields:**

- `lessonId` (Text) - Reference to lesson's PocketBase ID (from `church_latin_lessons`)
- `latinContent` (Text) - Latin text content for the lesson
- `englishTranslation` (Text) - English translation and explanation
- `vocabularyList` (JSON) - Array of vocabulary words with definitions

**Indexes:**

- Create an index on `lessonId` for content retrieval

### 6. **church_latin_quizzes**

Stores quiz questions and data for each lesson.

**Fields:**

- `lessonId` (Text) - Reference to lesson's PocketBase ID (from `church_latin_lessons`)
- `quizQuestions` (JSON) - Array of quiz question objects with structure:

  ```json
  [
    {
      "id": 1,
      "question": "Question text",
      "type": "multiple-choice|translation|recitation|matching",
      "options": ["option1", "option2"],
      "correctAnswer": "option1 or string or array",
      "explanation": "Explanation text"
    }
  ]
  ```

**Indexes:**

- Create an index on `lessonId` for quiz retrieval

### Setup Recommendations

1. **Enable API Rules**: Configure API rules to restrict access based on user authentication
2. **Enable Real-time Sync**: Consider enabling real-time updates if using multiple devices
3. **Set up Backups**: Configure regular backups for your PocketBase instance
4. **Seed Initial Data**: Use the migration scripts in `scripts/` to populate initial course data:

```bash
VITE_POCKETBASE_URL=http://localhost:8090 \
PB_ADMIN_EMAIL=admin@example.com \
PB_ADMIN_PASSWORD=your_password \
npx ts-node scripts/seedCollections.ts
```
